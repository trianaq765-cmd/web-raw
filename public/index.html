<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Roblox Paste</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      min-height: 100vh;
      color: #fff;
      padding: 20px;
    }
    .container { max-width: 800px; margin: 0 auto; }
    h1 { text-align: center; color: #00d9ff; margin-bottom: 10px; }
    .subtitle { text-align: center; color: #888; margin-bottom: 30px; }
    .form-box {
      background: #0f0f23;
      padding: 25px;
      border-radius: 15px;
      border: 1px solid #333;
    }
    label { display: block; color: #00d9ff; margin-bottom: 8px; font-weight: 500; }
    input[type="text"], textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #333;
      border-radius: 8px;
      background: #1a1a2e;
      color: #fff;
      font-size: 14px;
      margin-bottom: 20px;
    }
    textarea {
      height: 280px;
      font-family: 'Consolas', monospace;
      color: #0f0;
      resize: vertical;
    }
    input:focus, textarea:focus { outline: none; border-color: #00d9ff; }

    /* Tab Styles */
    .tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid #333;
    }
    .tab {
      padding: 12px 25px;
      background: transparent;
      color: #888;
      border: none;
      cursor: pointer;
      font-size: 14px;
      border-bottom: 2px solid transparent;
      transition: all 0.3s;
    }
    .tab:hover { color: #fff; }
    .tab.active {
      color: #00d9ff;
      border-bottom-color: #00d9ff;
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Upload Area */
    .upload-area {
      border: 2px dashed #333;
      border-radius: 10px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 20px;
    }
    .upload-area:hover, .upload-area.dragover {
      border-color: #00d9ff;
      background: rgba(0, 217, 255, 0.05);
    }
    .upload-area.has-file {
      border-color: #0f0;
      background: rgba(0, 255, 0, 0.05);
    }
    .upload-icon { font-size: 48px; margin-bottom: 15px; }
    .upload-text { color: #888; margin-bottom: 10px; }
    .upload-hint { color: #666; font-size: 12px; }
    .file-input { display: none; }
    .file-info {
      background: #1a1a2e;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
    }
    .file-info.show { display: block; }
    .file-info .name { color: #0f0; font-weight: bold; }
    .file-info .size { color: #888; font-size: 12px; }

    /* Buttons */
    .btn {
      padding: 12px 30px;
      background: linear-gradient(135deg, #00d9ff, #0066ff);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn:hover { opacity: 0.9; transform: translateY(-2px); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .btn-secondary {
      background: #333;
      margin-left: 10px;
    }

    /* Result */
    .result {
      margin-top: 25px;
      padding: 20px;
      background: #1a1a2e;
      border-radius: 10px;
      border: 1px solid #0f0;
      display: none;
    }
    .result.show { display: block; }
    .result h3 { color: #0f0; margin-bottom: 15px; }
    .url-row { display: flex; gap: 10px; margin-bottom: 15px; }
    .url-row input {
      flex: 1;
      margin-bottom: 0;
      color: #00d9ff;
      font-family: monospace;
    }
    .btn-copy {
      padding: 12px 20px;
      background: #333;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .btn-copy:hover { background: #444; }
    .loadstring-box {
      margin-top: 15px;
      padding: 15px;
      background: #000;
      border-radius: 8px;
      border-left: 3px solid #0f0;
    }
    .loadstring-box code {
      color: #0f0;
      font-family: 'Consolas', monospace;
      font-size: 13px;
      word-break: break-all;
    }
    .stats {
      display: flex;
      gap: 20px;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #333;
      color: #888;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéÆ Roblox Paste</h1>
    <p class="subtitle">Upload script Lua untuk loadstring() - Support file sampai 2MB</p>

    <div class="form-box">
      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" onclick="switchTab('paste')">üìù Paste Text</button>
        <button class="tab" onclick="switchTab('upload')">üìÅ Upload File</button>
      </div>

      <!-- Title Input (shared) -->
      <label>üìù Judul (opsional)</label>
      <input type="text" id="title" placeholder="Contoh: Auto Farm Script">

      <!-- Tab 1: Paste Text -->
      <div class="tab-content active" id="tab-paste">
        <label>üíª Script Lua</label>
        <textarea id="content" placeholder="-- Paste script kamu di sini...

print('Hello World!')"></textarea>
      </div>

      <!-- Tab 2: Upload File -->
      <div class="tab-content" id="tab-upload">
        <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
          <div class="upload-icon">üìÅ</div>
          <div class="upload-text">Klik untuk pilih file atau drag & drop</div>
          <div class="upload-hint">Support: .lua, .txt (Max 2MB)</div>
        </div>
        <input type="file" id="fileInput" class="file-input" accept=".lua,.txt" onchange="handleFile(this)">
        
        <div class="file-info" id="fileInfo">
          <span class="name" id="fileName"></span>
          <span class="size" id="fileSize"></span>
          <button class="btn-copy" onclick="clearFile()" style="float:right; padding:5px 10px;">‚úï Hapus</button>
        </div>
      </div>

      <!-- Buttons -->
      <button class="btn" id="submitBtn" onclick="createPaste()">üöÄ Buat Paste</button>
      <button class="btn btn-secondary" onclick="clearAll()">üóëÔ∏è Clear</button>

      <!-- Result -->
      <div class="result" id="result">
        <h3>‚úÖ Berhasil!</h3>

        <label>üîó View URL:</label>
        <div class="url-row">
          <input type="text" id="viewUrl" readonly>
          <button class="btn-copy" onclick="copyText('viewUrl')">Copy</button>
        </div>

        <label>üìÑ Raw URL (untuk Roblox):</label>
        <div class="url-row">
          <input type="text" id="rawUrl" readonly>
          <button class="btn-copy" onclick="copyText('rawUrl')">Copy</button>
        </div>

        <div class="loadstring-box">
          <label>üìã Pakai di Roblox Executor:</label>
          <code id="loadstringCode"></code>
        </div>

        <div class="stats">
          <span>üì¶ Size: <strong id="resultSize">0 KB</strong></span>
          <span>üîó ID: <strong id="resultId">-</strong></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentTab = 'paste';
    let uploadedContent = '';

    // Tab switching
    function switchTab(tab) {
      currentTab = tab;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      
      document.querySelector(`.tab:nth-child(${tab === 'paste' ? 1 : 2})`).classList.add('active');
      document.getElementById('tab-' + tab).classList.add('active');
    }

    // Drag & Drop
    const uploadArea = document.getElementById('uploadArea');
    
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file) processFile(file);
    });

    // Handle file selection
    function handleFile(input) {
      const file = input.files[0];
      if (file) processFile(file);
    }

    function processFile(file) {
      // Check extension
      const ext = file.name.split('.').pop().toLowerCase();
      if (!['lua', 'txt'].includes(ext)) {
        alert('Hanya file .lua atau .txt yang diizinkan!');
        return;
      }

      // Check size (2MB max)
      if (file.size > 2 * 1024 * 1024) {
        alert('File terlalu besar! Maksimal 2MB.');
        return;
      }

      const reader = new FileReader();
      reader.onload = (e) => {
        uploadedContent = e.target.result;
        
        // Update UI
        document.getElementById('fileName').textContent = 'üìÑ ' + file.name;
        document.getElementById('fileSize').textContent = ' (' + formatSize(file.size) + ')';
        document.getElementById('fileInfo').classList.add('show');
        uploadArea.classList.add('has-file');
        
        // Auto fill title if empty
        if (!document.getElementById('title').value) {
          document.getElementById('title').value = file.name.replace(/\.[^/.]+$/, '');
        }
      };
      reader.readAsText(file);
    }

    function clearFile() {
      uploadedContent = '';
      document.getElementById('fileInput').value = '';
      document.getElementById('fileInfo').classList.remove('show');
      uploadArea.classList.remove('has-file');
    }

    function clearAll() {
      document.getElementById('title').value = '';
      document.getElementById('content').value = '';
      document.getElementById('result').classList.remove('show');
      clearFile();
    }

    function formatSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
    }

    // Create paste
    async function createPaste() {
      const title = document.getElementById('title').value;
      let content = '';

      // Get content based on current tab
      if (currentTab === 'paste') {
        content = document.getElementById('content').value;
      } else {
        content = uploadedContent;
      }

      if (!content.trim()) {
        alert('Script tidak boleh kosong!');
        return;
      }

      const btn = document.getElementById('submitBtn');
      const result = document.getElementById('result');

      btn.disabled = true;
      btn.textContent = '‚è≥ Menyimpan...';

      try {
        const res = await fetch('/api/paste', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, content })
        });

        const data = await res.json();

        if (data.success) {
          const base = window.location.origin;
          document.getElementById('viewUrl').value = base + data.data.url;
          document.getElementById('rawUrl').value = base + data.data.rawUrl;
          document.getElementById('loadstringCode').textContent = 
            'loadstring(game:HttpGet("' + base + data.data.rawUrl + '"))()';
          document.getElementById('resultSize').textContent = formatSize(data.data.size);
          document.getElementById('resultId').textContent = data.data.id;
          result.classList.add('show');
          
          // Scroll to result
          result.scrollIntoView({ behavior: 'smooth' });
        } else {
          alert('Error: ' + data.error);
        }
      } catch (err) {
        alert('Error: ' + err.message);
      }

      btn.disabled = false;
      btn.textContent = 'üöÄ Buat Paste';
    }

    function copyText(id) {
      const input = document.getElementById(id);
      input.select();
      document.execCommand('copy');
      
      const btn = input.nextElementSibling;
      const originalText = btn.textContent;
      btn.textContent = '‚úì Copied!';
      setTimeout(() => btn.textContent = originalText, 1500);
    }
  </script>
</body>
</html>
